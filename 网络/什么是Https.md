## 什么是Https
Https是Http协议的一种升级，因为Http在传输的过程是明文，一些敏感信息容易暴露。Https为了解决一个问题而诞生，它通过SSL协议建立安全传输环境，即使数据包被截获也因为数据包被加密而无法篡改或者暴露敏感信息

## SSL、TSL和Https有什么联系
SSL，英文全称Secure Sockets Layer，为Netscape所研发，用以保障在Internet上数据传输的安全，利用数据加密(Encryption)的技术，可确保数据在网络上的传输过程中不会被截取及窃听。SSL协议位于TCP/IP协议与各种应用层协议之间，为数据通讯提供安全支持。  
我们来看看SSL的发明历史，你就明白区别啦  
- 1994年，NetScape公司设计了SSL协议（Secure Sockets Layer）的1.0版，但是未发布。
- 1995年，NetScape公司发布SSL 2.0版，很快发现有严重漏洞。
- 1996年，SSL 3.0版问世，得到大规模应用。
- 1999年，互联网标准化组织ISOC接替NetScape公司，发布了SSL的升级版TLS 1.0版。
- 2006年和2008年，TLS进行了两次升级，分别为TLS 1.1版和TLS 1.2版。最新的变动是2011年TLS 1.2的修订版。  
很明显TLS就是SSL的升级版，那么它都升级哪些东西

1. 版本号：TLS记录格式与SSL记录格式相同，但版本号的值不同，TLS的版本1.0使用的版本号为SSLv3.1。
2. 报文鉴别码：SSLv3.0和TLS的MAC算法及MAC计算的范围不同。TLS使用了RFC-2104定义的HMAC算法。SSLv3.0使用了相似的算法，两者差别在于SSLv3.0中，填充字节与密钥之间采用的是连接运算，而HMAC算法采用的是异或运算。但是两者的安全程度是相同的。
3. 伪随机函数：TLS使用了称为PRF的伪随机函数来将密钥扩展成数据块，是更安全的方式。
4. 报警代码：TLS支持几乎所有的SSLv3.0报警代码，而且TLS还补充定义了很多报警代码，如解密失败（decryption_failed）、记录溢出（record_overflow）、未知CA（unknown_ca）、拒绝访问（access_denied）等。
5. 密文族和客户证书：SSLv3.0和TLS存在少量差别，即TLS不支持Fortezza密钥交换、加密算法和客户证书。
6. certificate_verify和finished消息：SSLv3.0和TLS在用certificate_verify和finished消息计算MD5和SHA-1散列码时，计算的输入有少许差别，但安全性相当。
7. 加密计算：TLS与SSLv3.0在计算主密值（master secret）时采用的方式不同。
8. 填充：用户数据加密之前需要增加的填充字节。在SSL中，填充后的数据长度要达到密文块长度的最小整数倍。而在TLS中，填充后的数据长度可以是密文块长度的任意整数倍（但填充的最大长度为255字节），这种方式可以防止基于对报文长度进行分析的攻击。
总而言之一句话：TLS比SSL更加标准化，更加安全  

SSL、TSL是介乎传输层和应用层之间，而Https是属于应用层。如果Https比作汽车，那么SSL就是公路

## Https工作原理
Http协议需要三次握手来建立连接，Https跟它不一样，可以看下图  
![](./images/https.png)
- 客户端发出请求，服务端接受请求后返回证书给客户端；（证书是通过正规单位发布的，有一些自己制定的，需要浏览器添加为信息，证书后面用来加密，相当于一把锁）
- 浏览器拿到证书后对证书进行检查，不合法终止连接；反之，浏览器会生成一串**随机字段**，用刚刚收到的证书加密，最后将加密过的随机字段发送给服务器
- 服务器收到加密过的随机字段后，用自己的秘钥解密得到**随机字段**
> 好奇怪，为什么服务器有秘钥解密？其实证书和秘钥是一对的，证书是锁，秘钥是钥匙。申请证书的时候一起产生的，秘钥只保存在自己的服务器上，这样能保证别人不能破解报文
- 服务器拿到**随机字段**后，用随机字段来加密**返回的内容**，返回给客户端
- 客户端拿到返回内容后，用随机字段解密就可以拿到返回内容了  

整个过程需要多次加密，但整体分两种：1.建立连接对客户端**随机字段**加密 2.对返回内容加密


## Https疑问
1. 为什么使用Charles、Fiddle捉到的包可以看到报文
> 因为Https的加密过程在SSL完成，而Charles、Fiddle是属于应用层的应用

2. Https性能不好
> 因为Https多处需要加密，采用不同的加密方式对性能也不同，据统计，一次传输，如果采用非对称加密，90%的时间都用在解密上。因为在一些安全性要求不高的项目不需要使用Https