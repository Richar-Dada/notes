<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body{
            margin: 0;
        }

        #c {
            width: 100vw;
            height: 100vh;
            display: block;
        }
        #noOffscreenCanvas {
            display: flex;
            width: 100vw;
            height: 100vh;
            align-items: center;
            justify-content: center;
            background: red;
            color: white;
        }
    </style>
</head>
<body>
    <canvas id="c"></canvas>
    <div id="noOffscreenCanvas" style="display:none;">
        <div>no OffscreenCanvas</div>
    </div>
</body>
</html>

<script type="module">
    function main() {
        const canvas = document.querySelector('#c')
        if(!canvas.transferControlToOffscreen) {
            canvas.style.display = 'none'
            document.querySelector('#noOffscreenCanvas').style.display = ''
            return
        }
        const offscreen = canvas.transferControlToOffscreen()
        const worker = new Worker('./offscreencanvas-cubes.js', {type: 'module'})
        worker.postMessage({type: 'main', canvas: offscreen}, [offscreen])

        console.log('main')
        function sendSize() {
            worker.postMessage({
                type: 'size',
                width: canvas.clientWidth,
                height: canvas.clientHeight
            })
        }

        window.addEventListener('resize', sendSize)
        sendSize()
    }
    main()
</script>