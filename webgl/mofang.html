<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<script src="./js/three.min.js"></script>
<script>
    var cubeParams = {
        x: 0,
        y: 0,
        z: 0,
        num: 3,
        len: 3,
        colors: [
            '0xff0000',
            '0x00ff00',
            '0x0000ff',
            '0xfff000',
            '0xff00f0',
            '0x00000f'
        ]
    }
    function threeStart(){
        initThree()
        initCamera()
        initScene()
        initLight()
        initObject()
        render()
    }

    function initThree(){
        width = document.getElementById('canvas-frame').clientWidth;
        height = document.getElementById('canvas-frame').clientHeight;
        renderer = new THREE.WebGLRenderer({
            antialias : true
        });
        renderer.setSize(width, height);
        document.getElementById('canvas-frame').appendChild(renderer.domElement);
        renderer.setClearColor(0xFFFFFF, 1.0);
    }

    var camera
    function initCamera(){
        camera = new THREE.PerspectiveCamera(45, width / height, 1, 10000);
        camera.position.x = 0;
        camera.position.y = 1000;
        camera.position.z = 0;
        camera.up.x = 0;
        camera.up.y = 0;
        camera.up.z = 1;
        camera.lookAt({
            x : 0,
            y : 0,
            z : 0
        });
    }

    var scene
    function initScene(){
        scene = new THREE.Scene()
    }

    var light
    function initLight(){}

    var cubes
    function initObject(){
        cubes = SimpleCube(cubeParams.x, cubeParams.y, cubeParams.z, cubeParams.num, cubeParams.len, cubeParams.colors)
        for(var i=0;i<cubes.length;i++){
            var item = cubes[i]
            scene.add(cubes[i])
        }
    }

    function render(){
        renderer.render(scene, camera)
        requestAnimationFrame(render)
    }

    function SimpleCube(x, y, z, num, len, colors){
        var cubes = []
        for(var i = 0; i < num; i++){
            for(var j = 0; j < num*num; j++){
                var cubegeo = new THREE.BoxGeometry(len, len, len)
                var materals = []
                var myFaces = []

                myFaces.push(faces(colors[0]))
                myFaces.push(faces(colors[1]))
                myFaces.push(faces(colors[2]))
                myFaces.push(faces(colors[3]))
                myFaces.push(faces(colors[4]))
                myFaces.push(faces(colors[5]))
                
                for(var k = 0; k < 6; k ++){
                    var texture = new THREE.Texture(myFaces[k])
                    texture.needsUpdate = true
                    materals.push(new THREE.MeshLambertMaterial({
                        map: texture
                    }))
                }

                var cubemat = new THREE.MeshLambertMaterial(materals)
                var cube = new THREE.Mesh(cubegeo, cubemat)

                cube.position.x = (x+len/2) + (j%3)*len
                cube.position.y = (y-len/2) + parseInt(j/3)*len
                cube.position.z = (z-len/2) - i*len
            }
        }
        return cubes
    }

    function faces(rgbaColor){
        var canvas = document.createElement('canvas')
        canvas.width = 256
        canvas.height = 256
        var context = canvas.getContext('2d')
        if(context){
            context.fillStyle = 'rgba(0,0,0,1)'
            context.fillRect(0, 0, 256, 256)
            context.rect(16, 16, 224, 224)
            context.lineJoin = 'round'
            context.lineWidth = 16
            context.fillStyle = rgbaColor
            context.strokeStyle = rgbaColor
            context.stroke()
            context.fill()
        } else {
            alert('浏览器不支持canvas')
        }
        return canvas
    }
</script>
<body onload="threeStart()">
    <div id="canvas-frame"></div>
</body>
</html>